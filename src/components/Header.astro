---
import { ViewTransitions } from "astro:transitions";

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/work", label: "Work" },
  { href: "/resume", label: "Résumé" },
  { href: "/about", label: "About" },
];

const currentPath = Astro.url.pathname;

const isActive = (href: string) => {
  // Normalize paths by removing trailing slashes
  const normalizedCurrentPath = currentPath.endsWith("/")
    ? currentPath.slice(0, -1)
    : currentPath;
  const normalizedHref = href.endsWith("/") ? href.slice(0, -1) : href;

  // For home page, only match exact "/"
  if (normalizedHref === "") {
    return normalizedCurrentPath === "";
  }

  // For work section and its subpages
  if (normalizedHref === "/work") {
    return (
      normalizedCurrentPath === "/work" ||
      normalizedCurrentPath.startsWith("/work/")
    );
  }

  // For all other pages, match exact paths only
  return normalizedCurrentPath === normalizedHref;
};
---

<ViewTransitions />

<!-- mobile header -->
<header class="relative w-full" id="main-header">
  <div
    class="w-full mx-auto px-4 md:hidden container grid transition-all duration-300 ease-in-out grid-cols-1 pt-6 justify-between items-end relative after:content-[''] after:block after:absolute after:w-[calc(100%-2rem)] after:h-[2px] after:bg-tertiary after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:z-0"
  >
    <a
      href="/"
      class="text-xl w-full font-variable font-variable-sm transition-all duration-150 ease-in-out block font-bold text-dark border-b-2 pb-2 relative z-10 border-accent"
    >
      Charles <span class="text-accent">Amyx</span>
    </a>
  </div>

  <!-- Mobile Pill Navigation -->
  <div class="fixed bottom-6 left-1/2 -translate-x-1/2 md:hidden z-50">
    <nav
      class="bg-white rounded-full shadow-lg px-6 py-3 border border-tertiary"
    >
      <ul class="flex space-x-6">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class={`text-base font-medium transition-colors duration-300 ${
                  isActive(link.href)
                    ? "text-accent"
                    : "text-primary hover:text-accent"
                }`}
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
  </div>

  <!-- Desktop Menu -->
  <div
    class="hidden w-full mx-auto px-4 gap-6 md:grid transition-all duration-300 ease-in-out md:grid-cols-12 pt-6 justify-between items-end container relative after:content-[''] after:block after:absolute after:w-[calc(100%-2rem)] after:h-[2px] after:bg-tertiary after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:z-0"
  >
    <a
      href="/"
      class="text-xl lg:text-[2rem] block transition-all font-variable font-variable-sm lg:font-variable-lg duration-150 ease-in-out col-span-3 text-primary border-b-2 pb-2 relative z-10 border-accent"
    >
      Charles<span class="text-accent">Amyx</span>
    </a>
    <nav class="col-span-8 w-full col-start-10">
      <ul class="grid grid-cols-4 gap-6 font-medium relative z-10">
        {
          navLinks.map((link) => (
            <li
              class="pb-2 border-b-2 transition-all duration-300 ease-in-out relative"
              data-nav-item
            >
              <a
                href={link.href}
                class="transition-all duration-300 ease-in-out block nav-link"
                data-nav-link
                data-active={isActive(link.href)}
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
  </div>
</header>
